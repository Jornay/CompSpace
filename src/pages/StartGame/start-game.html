<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../../css/pages/start-game.css">
  <link rel="stylesheet" href="../../css/variables.css">
  <link rel="stylesheet" href="../../css/parallax.css">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <script src="../../scripts/functions/start-game.js"></script>
  <link rel="icon" href="../../assets/img/rocket.gif">
  <title>CompSpace | Start Game</title>
</head>

<body>
  <div class="game">
    <div class="game--title">
      <h1 class="game--title--h1">CompSpace
      </h1>
    </div>
    <div class="content">
      <div id='stars'></div>
      <div id='stars2'></div>
      <div id='stars3'></div>
      <div id='welcome'>
        <p>Seja bem-vindo(a) ao CompSpace. Quem partir√° dessa para uma melhor como uma lenda?</p>
      </div>
      <img id="spaceship" src="../../assets/img/rocket.gif" alt="">
    </div>
    <div class="rooms--party">
      <ul id="lista"></ul>
      <input type="button" class="btn-rooms btn-primary" onclick="showRooms()" value="Salas">
      <input type="button" class="btn-rooms btn-primary" onclick="clearRooms()" value="Apagar">
    </div>
    <footer>
      <div class="play--container">
        <form id="form" action="">
          <input type="text" id="username-input" class="input--username btn-primary" placeholder="Nome"
            autocomplete="off" maxlength="10">
          <button class="btn--play btn-primary">
            Jogar
          </button>
        </form>
      </div>
    </footer>
  </div>
  <!-- Alterar para arquivo separado -->
  <script src="/socket.io/socket.io.js"></script>
  <script>
    var socket = io();

    var form = document.getElementById('form');
    var input = document.getElementById('username-input');
    var username;

    form.addEventListener('submit', function (e) {
      e.preventDefault();
      if (input.value) {
        username = input.value;
        input.value = '';
      } else {
        username = `convidado_${Math.random().toString(36).substr(2, 9)}`;
      }
      socket.emit('create room', username);
      if (localStorage.getItem('rooms')) {
        let rooms = []
        rooms.push(localStorage.getItem('rooms'));
        rooms.push(username);
        localStorage.setItem('rooms', rooms);
      }else{
        localStorage.setItem('rooms', username);
      }
      window.location.href = '/GameRunning'
    });

    function showRooms() {
      let rooms = []
      rooms.push(localStorage.getItem('rooms'));
      let roomsList = rooms[0].split(',');
      let lista = document.getElementById('lista');
      for (var i = 0; i < roomsList.length; i++) {
        let item = document.createElement('li');
        item.appendChild(document.createTextNode(roomsList[i]));
        lista.appendChild(item);
      }
    }

    function clearRooms(){
      localStorage.setItem('rooms', '')
    }
  </script>
</body>

</html>